<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2014 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php if($this->getItems()->getSize()): ?>
<div class="product-section">
	<div class="container clearfix">
		<h2 class="slider-lable"><?php echo $this->__('Related products') ?></h2>
		<div class="categoryList products-grid">
			<div id="owlDemo6" class="owl-carousel"> 
				<?php $totalproduct1 = $this->getItems()->getSize();
				$x= 0; $_columnCount = 2; ?>
						   <?php foreach($this->getItems() as $_item): ?>
						   <?php if ($x++%$_columnCount==0): ?>
					<div class="item clearfix">
						<?php endif; ?>
						<div class="allpro">
							<div class="category-image">
								<?php 
								// Get the Special Price
								$specialprice = Mage::getModel('catalog/product')->load($_item->getId())->getSpecialPrice(); 
								// Get the Special Price FROM date
								$specialPriceFromDate = Mage::getModel('catalog/product')->load($_item->getId())->getSpecialFromDate();
								// Get the Special Price TO date
								$specialPriceToDate = Mage::getModel('catalog/product')->load($_item->getId())->getSpecialToDate();
								// Get Current date
								$today =  time();
								 
								if ($specialprice):
									if($today >= strtotime( $specialPriceFromDate) && $today <= strtotime($specialPriceToDate) || $today >= strtotime( $specialPriceFromDate) && is_null($specialPriceToDate)):
								?>
									<div class="on-sale-icn"></div>
								<?php  
									endif;
								endif;
								?>
								<a href="<?php echo $_item->getProductUrl() ?>" title="<?php echo $this->escapeHtml($_item->getName()) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_item, 'small_image')->resize(200) ?>" width="200" height="200" alt="<?php echo $this->escapeHtml($_item->getName()) ?>" /></a>
							</div>
							<div class="product-info">
							  <h2 class="product-name"><a href="<?php echo $_item->getProductUrl() ?>"><?php echo $this->escapeHtml($_item->getName()) ?></a></h2>
								<?php 
								$my_attribute = $_item->getAttributeText('callforpricing');
								if($my_attribute == 'Yes'){ ?>
									<span class="callof"><strong><?php echo $this->__('Call for price') ;?></strong></span>
								<?php }else{?>
								<?php echo $this->getPriceHtml($_item, true, '-related') ?>
								<?php
								} ?>
									
							</div>
							<!--<form action="<?php echo $this->getAddToCartUrl($_item) ?>" method="post" id="product_addtocart_form_<?php echo $_item->getId()?>"<?php if($_item->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>> 
								<button type="button" onclick="this.form.submit()"><span><span><span><?php echo $this->__('Add to Cart') ?></span></span></span></button>
							</form>-->
							<div class="addtocart">
							<a href="<?php echo Mage::helper('checkout/cart')->getAddUrl($_item); ?>" title="Add to Cart">Add To Cart</a>
							</div>
							<div class="clear"></div>
						</div>
						<?php if ($x%$_columnCount==0 || $x==$totalproduct1): ?>
				</div>
					<?php endif; ?>
					<?php endforeach ?>
			</div>
		</div>   
			<script type="text/javascript">decorateList('block-related', 'none-recursive')</script>
		<script type="text/javascript">
		//<![CDATA[
		$$('.related-checkbox').each(function(elem){
			Event.observe(elem, 'click', addRelatedToProduct)
		});
	
		var relatedProductsCheckFlag = false;
		function selectAllRelated(txt){
			if (relatedProductsCheckFlag == false) {
				$$('.related-checkbox').each(function(elem){
					elem.checked = true;
				});
				relatedProductsCheckFlag = true;
				txt.innerHTML="<?php echo $this->__('unselect all') ?>";
			} else {
				$$('.related-checkbox').each(function(elem){
					elem.checked = false;
				});
				relatedProductsCheckFlag = false;
				txt.innerHTML="<?php echo $this->__('select all') ?>";
			}
			addRelatedToProduct();
		}
	
		function addRelatedToProduct(){
			var checkboxes = $$('.related-checkbox');
			var values = [];
			for(var i=0;i<checkboxes.length;i++){
				if(checkboxes[i].checked) values.push(checkboxes[i].value);
			}
			if($('related-products-field')){
				$('related-products-field').value = values.join(',');
			}
		}
		//]]>
		</script>
	</div>
</div>
<?php endif ?>