<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2014 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */

/**
 * Set 'LoginBackUrl' variable in session when loading header.phtml (this file) for the wished page
 */
if(!Mage::helper('customer')->isLoggedIn()){
	$loginback=$this->helper('core/url')->getCurrentUrl();
	$check=strstr($loginback, 'customer/account/login');  //check if not loading header.phtml (this) for the redirected login page
	if(!strlen($check)){
		Mage::getSingleton('core/session')->setLoginBackUrl($loginback);
	}
}
?>
<header id="header" class="header-full">
	<div class="topLinks mob-hedr">
		<ul class="links">
			<?php if (!Mage::getSingleton('customer/session')->isLoggedIn()){ ?>
				<li>
					<form action="<?php echo str_replace('login', 'loginPost', $this->helper('customer')->getLoginUrl()) ?>" method="post" id="login-form" class="scaffold-form">
						<?php echo $this->getBlockHtml('formkey'); ?>
						<input type="hidden" name="product" value="<?php echo $proid ?>" />
						<div class="custom-login forMobile">
							
							<?php // This column should be col-1 if the registration column is not displayed ?>
							<div class="<?php if ($this->helper('customer')->isRegistrationAllowed()): ?>col-2<?php else: ?>col-1<?php endif; ?> registered-users">
								<div class="content fieldset">
									<ul class="cust-form-list">
										<!--<li class="cust_login_title"><i class="fa fa-lock"></i>Account Login</li>-->
										<li>
											<div class="input-box">
												<input type="email" autocapitalize="off" autocorrect="off" spellcheck="false" name="login[username]" value="<?php echo $this->escapeHtml($this->getUsername()) ?>" id="email" class="input-text required-entry validate-email" title="<?php echo $this->__('user name') ?>" placeholder="<?php echo $this->__('Username') ?>" />
											</div>
										</li>
										<li>
											<div class="input-box">
												<input type="password" name="login[password]" class="input-text required-entry validate-password" id="pass" title="<?php echo $this->__('Password') ?>" placeholder="<?php echo $this->__('password') ?>" />
											</div>
										</li>
										<?php //echo $this->getChildHtml('form.additional.info'); ?>
										<?php //echo $this->getChildHtml('persistent.remember.me'); ?>
									
										<?php //echo $this->getChildHtml('persistent.remember.me.tooltip'); ?>
								
										<li class="cust-buttons-set">
											<button type="submit" class="button" title="<?php echo $this->__('Login') ?>" name="send" id="send2"><span><span><?php echo $this->__('Login') ?></span></span></button>
										</li>
										<!--<li class="forgot_psw">
											<a href="<?php //echo $this->getBaseUrl(); ?>customer/account/forgotpassword/" class="f-left"><?php //echo $this->__('Forgot Your Password?') ?></a>
										</li>-->
									</ul>
								</div>	
							</div>
						</div>
						<?php /*if (Mage::helper('checkout')->isContextCheckout()): ?>
							<input name="context" type="hidden" value="checkout" />
						<?php endif; */?>
					</form>
				</li>
			<?php
			}else{
			?>
			
			
			
			
			
			<li><a href="<?php echo Mage::getUrl('customer/account');?>"><i class="fa fa-user"></i>My Account</a></li>
			<li><a href="<?php echo Mage::getUrl('sales/order/history/');?>"><i class="fa fa-edit"></i>My Orders</a></li>
			<?php if (!Mage::getSingleton('customer/session')->isLoggedIn()): ?>
				<li><a href="<?php echo Mage::helper('customer')->getLoginUrl(); ?>"><i class="fa fa-lock"></i><?php echo $this->__('Login') ?></a></li>
			<?php else: ?>
				<li><a href="<?php echo Mage::helper('customer')->getLogoutUrl(); ?>"><i class="fa fa-lock"></i><?php echo $this->__('Logout') ?></a></li>
			<?php endif;
			}
			?>
		</ul>
	</div>
	<div class="topLinks">
		<ul class="links">
			<li><a href="<?php echo $this->getUrl('')?>">HOME</a></li>
			<li><a href="<?php echo $this->getUrl('about-us')?>">ABOUT US</a></li>
			<li><a href="<?php echo $this->getUrl('')?>request-catalog">REQUEST CATALOG</a></li>
			<li class="clearence"><a href="<?php echo $this->getUrl('')?>clearance.html">CLEARANCE</a></li>
			<li><a href="<?php echo $this->getUrl('')?>free-samples">FREE SAMPLES</a> </li>
			<li><a href="<?php echo $this->getUrl('')?>shippinginfo-policies">SHIPPING INFO & POLICIES</a></li>
			<li><a href="<?php echo $this->getUrl('contacts')?>">CONTACT US</a></li>
		</ul>
	</div>
	<div class="container clearfix">
		<div class="logo-wrapper forMobile">
			<a class="logo" href="<?php echo $this->getUrl('') ?>">
				<img src="<?php echo $this->getLogoSrc() ?>" alt="<?php echo $this->getLogoAlt() ?>" class="large" />
				<img src="<?php echo $this->getLogoSrcSmall() ?>" alt="<?php echo $this->getLogoAlt() ?>" class="small" />
			</a>
			<?php echo $this->getLayout()->createBlock('core/template')->setTemplate('catalogsearch/newSearch.phtml')->toHtml(); ?>
		</div>
		<div class="headerRight">
			<div class="infoPanel">
				<?php echo $this->getChildHtml('topSearch'); ?>
				<div class="infoBoxRt">
					<div class="infoText callUs">
						<?php /*<style>
						.infoText .text1 a{ color: #000; }
						.fa-user-plus:before { content: "\f234"; }
						.fa-user-o:before { content: "\f007"; }
						</style> */ ?>
						<?php if(Mage::getSingleton('customer/session')->isLoggedIn()){ ?>
							<i class="fa fa-user-o"></i>
							<span class="text1"><a href="<?php echo $this->getUrl('customer/account') ?>" title="<?php echo $this->__('My account'); ?>"><?php echo $this->__('My account'); ?></a></span>
						<?php }else{ ?>
							<i class="fa fa-user-plus"></i>
							<span class="text1"><a href="<?php echo $this->getUrl('customer/account') ?>" title="<?php echo $this->__('Create account'); ?>"><?php echo $this->__('Create account'); ?></a></span>						
						<?php } ?>
						<!--<i class="fa fa-phone"></i>-->
						<!--<span class="text1">call <a href="tel:8002113147">800-221-3147</a></span>-->
						<!--<span class="text2">Providers of Jail Supplies</span>-->
					</div>
					<div class="infoText">
						<div class="header-minicart">
							<?php echo $this->getChildHtml('minicart_head'); ?>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
    <div class="navigationPan">
        <div class="container clearfix">
          <div class="allCate"> <span class="allCateClick">all categories <i class="fa fa-list"></i></span>
            <div class="allCateDrop">
                <?php 
               //$parentCategoryId =4;
                $children = Mage::getModel('catalog/category')->getCollection()->setStoreId(Mage::app()->getStore()->getId());
                $children->addAttributeToSelect('*')
                    ->addAttributeToFilter('parent_id',2 )
                    ->addAttributeToFilter('is_active', 1)//get only active categories if you want
                    ->addAttributeToSort('position');?>
				<ul>
                    <?php foreach($children as $subCatid){
					if ($subCatid->getIncludeInMenu()){	
						?>
			<li><a href="<?php echo $subCatid->getUrl() ?>"><?php echo $subCatid->getName() ?></a>
				<?php $collection = Mage::getModel('catalog/category')->getCollection();
				
				$collection->addAttributeToSelect('*') 
				 ->addIdFilter($subCatid->getChildren()) 
				 ->setOrder('name', Varien_Db_Select::SQL_ASC) 
				 ->load();?>
				 <?php if (count($collection) > 0){ ?>
				<i class="fa fa-caret-right"></i>
				
				<ul class="sub-menu">
					<div class="main-cat"><a href="<?php echo $subCatid->getUrl() ?>"><?php echo $subCatid->getName() ?></a></div>
					<?php foreach ($collection as $child) { ?>
					<li><a href="<?php echo $child->getUrl() ?>"><?php echo $child->getName() ?></a></li>
				       <?php }?>
				       <?php if ($_thumbnail = Mage::getModel('catalog/category')->load($subCatid->getId())->getImage()): ?>
					<?php $_imageurl = Mage::getBaseUrl('media') . 'catalog/category/' . $_thumbnail;?>
					<div class="sub-category-image">
					    <a title="<?php echo  $subCatid->getName(); ?>" href="<?php echo $subCatid->getUrl() ?>">
					    <img width="622" height="200" alt="<?php echo  $subCatid->getName(); ?>" src="<?php echo $_imageurl ?>">
					    </a>
					</div>
				    <?php endif; ?>
				       
			    </ul>
				
				<?php }
					}?>
				
			</li>
                    <?php } ?>
               </ul>
            </div>
          </div>
          <a class="skip-link skip-nav" href="#header-nav"> <span class="icon"></span> <span class="label">Menu</span> </a>
          <div class="skip-content" id="header-nav">
			  <?php echo $this->getChildHtml('topMenu') ?>
          </div>
			<?php if (!Mage::getSingleton('customer/session')->isLoggedIn()){ ?>
				<form action="<?php echo str_replace('login', 'loginPost', $this->helper('customer')->getLoginUrl()) ?>" method="post" id="login-form" class="scaffold-form">
					<?php echo $this->getBlockHtml('formkey'); ?>
					<input type="hidden" name="product" value="<?php echo $proid ?>" />
					<div class="custom-login">
						
						<?php // This column should be col-1 if the registration column is not displayed ?>
						<div class="<?php if ($this->helper('customer')->isRegistrationAllowed()): ?>col-2<?php else: ?>col-1<?php endif; ?> registered-users">
							<div class="content fieldset">
								<ul class="cust-form-list">
									<li class="cust_login_title"><i class="fa fa-lock"></i>Account Login</li>
									<li>
										<div class="input-box">
											<input type="email" autocapitalize="off" autocorrect="off" spellcheck="false" name="login[username]" value="<?php echo $this->escapeHtml($this->getUsername()) ?>" id="email" class="input-text required-entry validate-email" title="<?php echo $this->__('user name') ?>" placeholder="<?php echo $this->__('Username') ?>" />
										</div>
									</li>
									<li>
										<div class="input-box">
											<input type="password" name="login[password]" class="input-text required-entry validate-password" id="pass" title="<?php echo $this->__('Password') ?>" placeholder="<?php echo $this->__('password') ?>" />
										</div>
									</li>
									<?php echo $this->getChildHtml('form.additional.info'); ?>
									<?php echo $this->getChildHtml('persistent.remember.me'); ?>
									<?php echo $this->getChildHtml('persistent.remember.me.tooltip'); ?>
							
									<li class="cust-buttons-set">
										<button type="submit" class="button" title="<?php echo $this->__('Login') ?>" name="send" id="send2"><span><span><?php echo $this->__('Login') ?></span></span></button>
									</li>
									<li class="forgot_psw">
										<a href="<?php echo $this->getBaseUrl(); ?>customer/account/forgotpassword/" class="f-left"><?php echo $this->__('Forgot Your Password?') ?></a>
									</li>
								</ul>
							</div>	
						</div>
					</div>
					<?php /*if (Mage::helper('checkout')->isContextCheckout()): ?>
						<input name="context" type="hidden" value="checkout" />
					<?php endif; */?>
				</form>
				<?php
			}
			?>
        </div>
	</div>
</header>

<?php echo $this->getChildHtml('topContainer'); ?>

<script type="text/javascript">
    //<![CDATA[
        var dataForm = new VarienForm('login-form', true);
    //]]>
    </script>
<script type="text/javascript">
	jQuery(document).ready(function() {
		if (jQuery(window).width()>770){
			jQuery('.allCateDrop ul li.parent').hover(function(){
				jQuery(this).find("ul.sub-menu").css({'height':(jQuery('.allCateDrop').height())+'px'});
				//alert("done");
				var menuhgt = jQuery('.navigationPan').offset().top;
				var innerhgt = jQuery('.navigationPan').height();
				//alert(innerhgt);
				var toporghgt = (menuhgt + innerhgt) ;
				var tophgt = jQuery(this).find("ul.sub-menu").offset().top ;
				var orghgt = -(tophgt- toporghgt);
				jQuery(this).find("ul.sub-menu").css('top',orghgt);
				//alert(tophgt);
			},function(){
				jQuery(this).find("ul.sub-menu").attr('style','');
			});
		}else{
			jQuery('.skip-nav').click(function(e){
				e.preventDefault();
				if(jQuery('#header-nav').hasClass('skip-active')){
					jQuery('#header-nav').removeClass('skip-active');
				}else{
					jQuery('#header-nav').addClass('skip-active');
				}
			});
		}
		
		jQuery('.allCateDrop ul li.parent:eq(9)').addClass('hygiene');
	});
	jQuery(window).resize(function(){
		if (jQuery(window).width() > 770){
			jQuery('.allCateDrop ul li.parent').hover(function(){
				jQuery(this).find("ul.sub-menu").css({'height':(jQuery('.allCateDrop').height())+'px'});
				//alert("done");
				var menuhgt = jQuery('.navigationPan').offset().top;
				var innerhgt = jQuery('.navigationPan').height();
				//alert(innerhgt);
				var toporghgt = (menuhgt + innerhgt) ;
				var tophgt = jQuery(this).find("ul.sub-menu").offset().top ;
				var orghgt = -(tophgt- toporghgt);
				jQuery(this).find("ul.sub-menu").css('top',orghgt);
				//alert(tophgt);
			},function(){
				jQuery(this).find("ul.sub-menu").attr('style','');
			});
		}
		if(jQuery(window).width() < 770){
			jQuery('.skip-nav').click(function(e){
				if(jQuery('#header-nav').hasClass('skip-active')){
					jQuery('#header-nav').removeClass('skip-active');
				}else{
					jQuery('#header-nav').addClass('skip-active');
				}
				e.preventDefault();
			});
		}
	});		
</script>